<!DOCTYPE html>
<html>
<head>
	<title>GazerTest (WebGazer powered)</title>

	<script src="./js/WebGazer.js" type="text/javascript" ></script>
	<script src="./js/precision_store_points.js" type="text/javascript" ></script>
	<script src="./js/require.js" type="text/javascript" ></script>
	
	<script type="text/javascript">

		var logger;
		var flag=false;

		window.onload = function() {
    		webgazer.setRegression('threadedRidge') /* currently must set regression and tracker */
        		.setTracker('clmtrackr')
        		.begin()
        		.showPredictionPoints(true);
        	if (typeof(logger) == "undefined") {
    			logger = new Worker("./js/logger.js");
    			logger.postMessage(webgazer)
			}
        };
    </script>
</head>
<body>

	<button onclick="saveGazerData()">save</button>

	<script type="text/javascript">

		function saveGazerData(){
			
			//save fixaxion data
			flag = true;

			logger.onmessage = function(event) {
            	csvStuff = event.data;
            	flag= false;
        	};

			console.log(csvStuff)

			var csv = 'x fixations,y fixations,timeStamp';
    		csvStuff.forEach(function(row) {
            	csv += row.join(',');
            	csv += "\n";
    		});

			var hiddenElement = document.createElement('a');
			hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
			hiddenElement.target = '_blank';
			hiddenElement.download = 'myFile.csv';
			hiddenElement.click();

			logger.terminate();

		}
			

	</script>
</body>
</html>